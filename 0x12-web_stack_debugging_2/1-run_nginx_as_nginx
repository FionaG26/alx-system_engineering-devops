#!/usr/bin/env bash

# This script configures the container to run Nginx as the nginx user and listen on port 8080

# Create nginx user
useradd nginx

# Change ownership of Nginx files
chown -R nginx:nginx /etc/nginx /var/log/nginx /var/lib/nginx /var/www/html /run/nginx.pid

# Modify Nginx configuration file
sed -i 's/user\s*nginx;/user nginx nginx;/g' /etc/nginx/nginx.conf

# Restart Nginx service
service nginx restart

# Verify that Nginx is running as nginx user and listening on port 8080
ps auxff | grep 'nginx'
nc -z 0 8080 ; echo $?

